model:
  impl: zimage_turbo
  base:
    name: Tongyi-MAI/Z-Image-Turbo
    source: huggingface
    precision: bf16
    variant: turbo
  lora:
    enable: true
    rank: 64
    alpha: 64
    dropout: 0.0
    target_modules:
      - attention.to_q
      - attention.to_k
      - attention.to_v
      - attention.to_out

dataset:
  type: image_only_with_caption
  data_dir: ./data
  resolution: 512
  center_crop: true
  caption:
    strategy: filename_or_txt
    trigger_token: "<zstyle>"
  repeats: 10
  shuffle: true
  augment:
    horizontal_flip: true
    color_jitter: false

training:
  backend: lightning
  seed: 42
  num_workers: 4
  batch_size: 1
  gradient_accumulation: 4
  max_steps: 4000
  warmup_steps: 100
  learning_rate: 2e-4
  scheduler: none
  optimizer:
    type: adamw
    use_8bit: false
  mixed_precision: bf16
  gradient_checkpointing: false
  log_every_n_steps: 10
  val_check_interval: 0

job:
  id: ""
  type: async
  timeout_hours: 6
  retry:
    max_retries: 1
  resources:
    gpu: 1
    min_vram_gb: 24
  logging:
    level: info

output:
  format: safetensors
  registry:
    type: local
    path: ./artifacts/lora
  naming:
    pattern: "{job_id}_{style_name}_v1"
  style_name: zstyle
  save:
    lora_weights: true
    config: true
    training_meta: true
